stages:
  - install
  - build-test

cache:
  paths:
    - fronts/node_modules/
    - backend/venv/

install-fronts-dependencies:
  image: node:latest
  stage: install
  script:
    - cd fronts
    - echo "Installing packages..."
    - npm install
  artifacts:
    paths:
      - fronts/node_modules/

install-backend-dependencies:
  image: python:3.8
  stage: install
  script:
    - cd backend
    - echo "Installing python env and requirements..."
    - python3 -m venv venv
    - source venv/bin/activate
    - pip install --upgrade pip
    - pip install -r requirements.txt
    - pip install -e ./src
  artifacts:
    paths:
      - backend/venv/

fronts-build-and-test:
  image: node:latest
  stage: build-test
  script:
    - cd fronts
    - echo "Building enki front app..."
    - npm run build enki
    - echo "Building couv-ops front app..."
    - npm run build couv-ops
    # - echo "Testing enki front app..."
    # - npm test enki
    - echo "Testing core-couv-ops..."
    - npm test core-couv-ops

back-build-and-test:
  image: python:3.8
  stage: build-test
  script:
    - cd backend
    - source venv/bin/activate
    - echo "Unit testing..."
    - pytest tests/unit
    - echo "Flask e2e testing..."
    - pytest tests/e2e


